# Types of Analysis
- ![[Pasted image 20230916113522.png]]
- Malware analysis can be shared but anti-virus software usually doesn't to not give malware more information so that those that write it can change theirs
## Basic Static Analysis
- Examining malware at rest
- Looking at the strings, functions imported, and metadata
	- Can see what functions that imports from the Windows API to see if it interacts with the OS
- Look at file similarity metrics (to id related malware)
- Try to find unusual features that guide next analysis steps, see what interesting parts of the file might need more investigation
- Malware is usually packed though, making basic static analysis much more difficult
- Unpacking malware manually can be very tedious
- Meet on Fridays at 4pm
## Basic Dynamic Analysis
- Observe the output and/or changes when malware is run
- Don't interact with malware, just see what it does
- Any changes to filesystem
- Created processes/threads
- Network traffic
- Changes to registry or sysconfig
- Can use sandbox or run malware in VM
## Advanced Static Analysis
- Examine malware's code in detail
- Use disassembler
	- Organize the code in subroutines
- Can also use decompiler to see what it looks like in C
- Will use IDA free or Ghidra in class
## Advanced Dynamic Analysis
- Use debugger to control any and all aspects of the malware
	- Registers, stack, memory, code
- Can "trick" malware in executing in ways it normally wouldn't
	- Necessary if it can hide behaviors if in a sandbox
- Memory dumping is usually when you debug, but it could also be considered static
## Detection, Classification, and Attribution
- Detection: Is a file benign or malicious
- Classification: What family of malware is this
- Attribution: Which person/group used this malware
## Other Objectives
- Determining what malicious behaviors it performed
- Deeply understand a function(s) in the file
- Identifying related malware samples
- Creating a signature for the malware
# Malware Triage
- Hundreds of thousands of unique, previously unseen malicious files created every day
- Many of these are minor alterations of existing malware
	- Malware authors continually update their malware to add new capes and evade detection
- Not enough time for human analysts to look at everything
	- **Triage**: give most attention to new/unusual/important samples
- Different levels of analysis given to different priority of malware
- All samples get at least basic static analysis
- Many samples receive sandbox runs
- Only a handful are given manual analysis
# Tools
## Strings
- Sequences of printable characters in a file
- Running strings on a file is usually first step of analysis
- Gives hints about functionality of program
- `strings -n 8 [file path] | less`
	- Gets all strings of length >= 8
- Almost all exe files start with ![[Pasted image 20230916143752.png]]
- Examples of function names
- ![[Pasted image 20230916143828.png]]
- 
## FLOSS
- Slightly more powerful than strings
- Extracts:
	- ASCII strings
	- UTF-16
	- Stack strings
	- Some encoded strings
- `floss -n 8 --no-decoded-strings [file path] | less`
# PE File Format
- File format for windows executables
- Includes EXE, DLL, SYS, and other file types
- Describes how the executable file is loaded into memory
- Contains lots of metadata that is useful to malware analysts
- Need to watch demo on PE File format
- ![[Pasted image 20230916144038.png]]
## IMAGE_FILE_HEADER
- Contains basic file info
	- NumberOfSections
	- TimeDateStamp
	- Characteristics
## IMAGE_OPTIONAL_HEADER
- Not actually optional
- Contains lots of important metadata:
	- AddressOfEntryPoint
	- Sizes of various parts of the file that get loaded into memory
	- Minimum versions of OS linker, image, subsystem
## Section Table
- Each section corresponds to a continuous area of memory in a process
- Section table contains an array of IMAGE_SECTION_HEADERs
## IMAGE_SECTION_HEADERs
- Each contains that section's:
	- Name
	- VirtualAddress
	- VirtualSize
	- SizeOfRawData
	- Characteristics
## Common PE Sections
Section name | Contents
------------ | ------------
.text | Executable code
.data | Initialized data
.idata | Import Address Table
.rsrc | Resource Directory Table
.rdata | Read-only initialized data
- Many other common section names
- Unusual section names are a malicious indicator
## Imports
- Import Address Table lists when functions a file imports from the Windows API
	- Windows API functions defined in DLL files
- Imports give info about what actions a file can perform
- Commonly second step in basic static analysis, after strings
## Resources
- Additional data/file contained within a PE file
- In legitimate files, often icons, application manifest, etc.
- ==Malware often hides things in resources==